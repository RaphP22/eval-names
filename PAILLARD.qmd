

---
title: "PAILLARD"
author: "Raphael Paillard"
format: html
---

```{r}
library(ggplot2)
library(dplyr)
library(tidyr)
library(readr)
library(here)

```

## Question 1 :

```{r}
courses <- read_csv("C:/Users/raphp/Downloads/subject-32/courses.csv")


```
## Question 2

```{r}
library(knitr)

courses <- courses %>%
  rename(
    "course_name" = course,
    "identifier" = course_id,
    "semester" = semester,
    "number_of_exams" = nb_grades
  )

courses_sorted <- courses %>%
  arrange(course_name)

kable(courses_sorted, caption = "Liste des cours triés par ordre alphabétique")

```

## Question 3

```{r}
students <- read_csv("C:/Users/raphp/Downloads/subject-32/students.csv")

students <- students %>%
  mutate(
    id = as.integer(id),
    group = as.factor(group),
    birth_dates = as.Date(birth_date),
    sex = as.factor(sex)
  )


cat("La colonne **birth_date** du data frame `students` est de classe", class(students$birth_dates))

```

## Question 4

```{r}
grades <- read_csv("C:/Users/raphp/Downloads/subject-32/grades.csv")
```



## Question 5
```{r}
students %>%
  group_by(group) %>%
  summarise(n = n()) %>%
  ggplot(aes(x = group, y = n)) +
  geom_col(fill = "steelblue") +
  labs(
    title = "Students per group",
    x = "Group",
    y = "Number of students"
  ) +
  theme_minimal()

```

## Question 6

```{r}
students %>%
  group_by(group, sex) %>%
  summarise(n = n(), .groups = "drop") %>%
  ggplot(aes(x = group, y = n, fill = sex)) +
  geom_col(position = "dodge") +
  labs(
    title = "repartition of gender per group",
    x = "Group",
    y = "number of students",
    fill = "gender"
  ) +
  theme_minimal()
```


## Question 7

```{r}
students <- students
  mutate(age = as.integer(format(Sys.Date(), "%Y")) - as.integer(format(birth_date, "%Y")))

students
  ggplot(aes(x = age)) +
  geom_histogram(binwidth = 1, fill = "lightgreen") +
  labs(
    title = "Age of students",
    x = "age",
    y = "number of students"
  ) +
  theme_minimal()



```

## Question 8 

```{r}
students <- students %>%
  mutate(age = as.integer(format(Sys.Date(), "%Y")) - as.integer(format(birth_date, "%Y")))

age_median <- students %>%
  group_by(group) %>%
  summarise(median_age = round(median(age), 0))  # Arrondir à l'entier

kable(age_median, caption = "Medium age of students per group")
```





## Question 9

```{r}

students <- students %>%
  mutate(age = as.integer(format(Sys.Date(), "%Y")) - as.integer(format(birth_date, "%Y")))

oldest_students <- students %>%
  group_by(group) %>%
  slice_max(age, with_ties = FALSE) %>%  
  ungroup() %>%
  arrange(desc(age)) %>% 
  select(id, sex, age)  

kable(oldest_students, caption = "oldest students per group")
```

## Question 10

```{r}

grades <- read_delim(
  "C:/Users/raphp/Downloads/subject-32/grades.csv",
  delim = ":",
  na = "unknown",
  col_names = TRUE
)
total_grades <- grades %>%
  filter(!is.na(grade)) %>%
  nrow()


cat("The dataset contains", total_grades, "notes.")


```
## Question 11 

```{r}
pharaonic_law_id <- courses %>%
  filter(course_name == "Pharaonic Law and Governance") %>%
  pull(identifier)

avg_grades_by_group <- grades %>%
  filter(course_id == pharaonic_law_id) %>%
  left_join(students, by = "id") %>%
  group_by(group) %>%
  summarise(avg_grade = mean(grade, na.rm = TRUE))

avg_grades_by_group %>%
  ggplot(aes(x = factor(group), y = avg_grade)) +
  geom_col(fill = "steelblue") +
  labs(
    title = "Average grades in Pharaonic Law and Governance per group",
    x = "Group",
    y = "average"
  ) +
  theme_minimal()



```


## Question 12 

```{r}
grades_with_semester <- grades %>%
  left_join(courses, by = c("course_id" = "identifier"))

grades_with_semester %>%
  filter(!is.na(grade)) %>%
  ggplot(aes(x = grade, fill = factor(semester))) +
  geom_density(alpha = 0.5) +
  labs(
    title = "Grades per semester",
    x = "grade",
    y = "density",
    fill = "semester"
  ) +
  theme_minimal()
```


## Question 13

```{r}
grades_per_student <- grades %>%
  filter(!is.na(grade)) %>%
  group_by(id) %>%
  summarise(nb_grades = n()) %>%
  left_join(students, by = "id") %>%
  select(id, group, sex, nb_grades)

grades_per_student %>%
  slice_head(n = 5) %>%
  kable(caption = "slice of number of grade per student")

grades_stats <- grades_per_student %>%
  summarise(
    min = min(nb_grades),
    max = max(nb_grades),
    mean = mean(nb_grades),
    median = median(nb_grades)
  )

kable(grades_stats, caption = "Stats about the number of grades per student")
```

## Question 14

```{r}
grades_per_student %>%
  ggplot(aes(x = nb_grades, fill = sex)) +
  geom_histogram(binwidth = 1, position = "dodge") +
  labs(
    title = "Distribution of nb of grade per gender",
    x = "nb of grades",
    y = "nb of students",
    fill = "gender"
  ) +
  theme_minimal()



```

## Question 15

```{r}
pyramid_id <- courses %>%
  filter(course_name == "Pyramid Construction and Engineering") %>%
  pull(identifier)

grades_pyramid <- grades %>%
  filter(course_id == pyramid_id) %>%
  group_by(id) %>%
  summarise(nb_grades = n()) %>%
  left_join(students %>% select(id, group), by = "id")

grades_pyramid %>%
  slice_head(n = 5) %>%
  kable(caption = "Slice of Nb of grades in Pyramid Construction and Engineering par étudiant")
```

## Question 16

```{r}



```







